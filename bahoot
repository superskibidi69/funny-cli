#!/bin/bash
set -e

# ğŸ¨ Terminal colors
RED='\033[0;31m'
GREEN='\033[0;32m'
CYAN='\033[0;36m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# ğŸŒ€ Animated loader
loader() {
  echo -n "Loading"
  for i in {1..5}; do
    echo -n "."
    sleep 0.2
  done
  echo ""
}

# ğŸš€ ASCII rocket launch
rocket() {
  frames=("ğŸš€" "ğŸš€ğŸ’¨" "ğŸš€     ğŸ’¨" "ğŸš€         ğŸ’¨" "ğŸš€             ğŸ’¨" "ğŸš€                 ğŸ’¥")
  for frame in "${frames[@]}"; do
    clear
    echo -e "${YELLOW}$frame${NC}"
    sleep 0.2
  done
}

# ğŸ§  Diagnostic scanner
doctor() {
  echo -e "${GREEN}ğŸ” Running diagnostics...${NC}"
  sleep 0.5
  echo "âœ… Bash version: $(bash --version | head -n 1)"
  echo "âœ… Terminal: $TERM"
  echo "âœ… User: $USER"
  echo "âœ… Host: $(hostname)"
  echo "âœ… Uptime: $(uptime -p)"
}

# ğŸ’¥ Fake meltdown
prank() {
  loader
  echo -e "${RED}ğŸ’¥ SYSTEM FAILURE DETECTED${NC}"
  sleep 0.5
  echo "Kernel panic: unexpected token 'bahoot'"
  sleep 0.5
  echo -e "${YELLOW} Dumping memory..."
  sleep 4.5
  echo -e "${RED} Memory dumped.${NC}"
  sleep 2
  echo "Just kidding ğŸ˜"
}

# ğŸ§¨ Chaos mode
chaos() {
  echo -e "${CYAN}ğŸ§¨ Entering chaos mode...${NC}"
  sleep 0.5
  for i in {1..20}; do
    echo -e "${RED}ERROR $i: sanity not found${NC}"
    sleep 0.1
  done
  echo -e "${CYAN}ğŸ’« Chaos complete.${NC}"
}

# ğŸ§ª Matrix mode
matrix() {
  echo -e "${GREEN}ğŸ§ª Entering matrix mode...${NC}"
  for i in {1..30}; do
    echo "$(cat /dev/urandom | tr -dc '01' | fold -w 80 | head -n 1)"
    sleep 0.05
  done
  echo -e "${GREEN}ğŸ§  Matrix exited.${NC}"
}
banner() {
  local lines=(
" ______  _______ _     _  _____   _____  _______"
" |_____] |_____| |_____| |     | |     |    |   "
" |_____] |     | |     | |_____| |_____|    |   "
  )
  clear
  for line in "${lines[@]}"; do
    # print each character with a short delay for a typewriter effect
    for ((i=0; i<${#line}; i++)); do
      echo -ne "${CYAN}${line:$i:1}${NC}"
      sleep 0.01
    done
    echo ""  # new line after each banner line
    sleep 0.15
  done
}
# ğŸ”„ Self-update
update() {
  echo -e "${CYAN}ğŸ”„ Updating Bahoot CLI...${NC}"
  curl -fsSL https://raw.githubusercontent.com/superskibidi69/funny-cli/main/bahoot -o "$0"
  chmod +x "$0"
  echo -e "${GREEN}âœ… Update complete!${NC}"
}

# ğŸ’£ Self-destruct
self_destruct() {
  echo -e "${RED}ğŸ’£ Self-destruct sequence initiated...${NC}"
  sleep 1
  echo "Deleting Bahoot CLI from: $0"
  rm -- "$0"
}

# ğŸ­ Troll mode
troll() {
  loader
  messages=("Installing virus..." "Formatting disk..." "Sending your IP to Bahoot HQ..." "Just kidding ğŸ˜")
  for msg in "${messages[@]}"; do
    echo -e "${RED}$msg${NC}"
    sleep 0.5
  done
}

# ğŸ‰ Party mode
party() {
  echo -e "${YELLOW}ğŸ‰ Welcome to Bahoot Party Mode!${NC}"
  for i in {1..10}; do
    echo -e "${CYAN}ğŸŠ ğŸˆ ğŸ‰ Bahoot rocks! ğŸ‰ ğŸˆ ğŸŠ${NC}"
    sleep 0.2
  done
}

# ğŸ¦  Fake virus scan
scan() {
  echo -e "${RED}ğŸ¦  Scanning system for viruses...${NC}"
  sleep 1
  echo "Found: 3 threats"
  sleep 1
  echo "Threat 1: Bahoot overload"
  echo "Threat 2: Excessive swag"
  echo "Threat 3: Terminal too cool"
  echo -e "${GREEN}âœ… All threats neutralized.${NC}"
}

# ğŸ–¥ï¸ Boot sequence
boot() {
  echo -e "${CYAN}ğŸ–¥ï¸ Booting Bahoot OS...${NC}"
  sleep 0.5
  echo "Initializing kernel..."
  sleep 0.5
  echo "Loading modules..."
  sleep 0.5
  echo "Mounting /bahoot..."
  sleep 0.5
  echo "Welcome to Bahoot OS ğŸ¤–"
}

# ğŸ’» Fake hacking
hack() {
  echo -e "${GREEN}ğŸ’» Hacking in progress...${NC}"
  for i in {1..20}; do
    echo "Accessing node $i... success"
    sleep 0.1
  done
  echo -e "${RED}ğŸ”¥ Firewall breached. Just kidding.${NC}"
}

# âš¡ Glitch effect
glitch() {
  for i in {1..10}; do
    echo -e "${RED}â–ˆâ–“â–’â–‘ GLITCH â–‘â–’â–“â–ˆ${NC}"
    sleep 0.1
    clear
  done
  echo "System stabilized."
}
ball() {
  tput civis  # hide cursor
  stty -echo  # disable input echoing
  
  local cols=$(tput cols)
  local rows=$(tput lines)
  local x=$((cols / 2))
  local y=$((rows / 2))
  local dx=1
  local dy=1
  local ball="â—"
  local trail_char="Â·"
  local colors=(31 32 33 36 35 34)  # ANSI color codes: red, green, yellow, cyan, magenta, blue
  local color_index=0
  local trail_length=12  # Increased length for better visual effect
  
  # Arrays to store trail positions and colors
  local -a trail_x=()
  local -a trail_y=()
  local -a trail_c=()
  local -a trail_age=()  # Track age of each trail segment
  
  # Clear screen initially
  clear

  trap "tput cnorm; stty echo; clear; exit" SIGINT SIGTERM

  while true; do
    # Store current position for trail (with age 0)
    trail_x=("$x" "${trail_x[@]:0:$trail_length}")
    trail_y=("$y" "${trail_y[@]:0:$trail_length}")
    trail_c=("$color_index" "${trail_c[@]:0:$trail_length}")
    trail_age=(0 "${trail_age[@]:0:$trail_length}")  # Newest trail has age 0

    # Clear previous ball position
    printf "\033[%d;%dH " "$y" "$x"

    # Draw trail with fading effect based on age
    for ((t=0; t<${#trail_x[@]}; t++)); do
      if [[ -n "${trail_x[t]}" && -n "${trail_y[t]}" ]]; then
        # Increase age of this trail segment
        trail_age[t]=$((trail_age[t] + 1))
        
        # Remove trail segments that are too old
        if [[ ${trail_age[t]} -gt $((trail_length / 2)) ]]; then
          printf "\033[%d;%dH " "${trail_y[t]}" "${trail_x[t]}"
          # Mark for removal by setting to empty
          trail_x[t]=""
          trail_y[t]=""
        else
          # Calculate fade intensity based on age
          local fade_intensity=$((trail_age[t] * 2))
          if [[ $fade_intensity -gt 5 ]]; then
            fade_intensity=5  # Cap the fade intensity
          fi
          
          # Draw with appropriate fade
          printf "\033[%d;%dH\033[2;%dm%s\033[0m" "${trail_y[t]}" "${trail_x[t]}" "${colors[trail_c[t]]}" "$trail_char"
        fi
      fi
    done

    # Move ball
    ((x += dx))
    ((y += dy))

    # Bounce off edges with proper boundary checking
    if ((x <= 1)); then
      x=2
      dx=$(( -dx ))
      color_index=$(( (color_index + 1) % ${#colors[@]} ))
    elif ((x >= cols)); then
      x=$((cols - 1))
      dx=$(( -dx ))
      color_index=$(( (color_index + 1) % ${#colors[@]} ))
    fi

    if ((y <= 1)); then
      y=2
      dy=$(( -dy ))
      color_index=$(( (color_index + 1) % ${#colors[@]} ))
    elif ((y >= rows)); then
      y=$((rows - 1))
      dy=$(( -dy ))
      color_index=$(( (color_index + 1) % ${#colors[@]} ))
    fi

    # Draw ball with current color
    printf "\033[%d;%dH\033[1;%dm%s\033[0m" "$y" "$x" "${colors[$color_index]}" "$ball"

    # Refresh display
    printf "\033[0;0H"  # Move cursor to top-left to minimize flickering

    sleep 0.0635363
  done
}
# ğŸ€ Fortune
fortune() {
  quotes=("You will write bug-free code today." "Bahoot believes in you." "Your terminal is your canvas." "Don't forget to hydrate.")
  echo -e "${GREEN}ğŸ€ Fortune:${NC} ${quotes[$RANDOM % ${#quotes[@]}]}"
}

# ğŸ”Š Echo with flair
echo_cmd() {
  echo -e "${CYAN}ğŸ”Š You said:${NC} $*"
}

# ğŸ§¼ Clear screen
clear_cmd() {
  clear
  echo -e "${GREEN}ğŸ§¼ Screen cleared.${NC}"
}

# ğŸ“œ Credits
credits() {
  echo -e "${CYAN}ğŸ“œ Bahoot CLI was built by superfood.${NC}"
  echo "Inspired by chaos, crafted with shell magic."
}

# ğŸ§¼ Help menu
help_menu() {
  echo -e "${CYAN}Bahoot CLI ğŸ¤– â€” Available commands:${NC}"
  echo "  prank          - Trigger a fake meltdown"
  echo "  deploy         - Launch ASCII rocket"
  echo "  chaos          - Enter chaos mode"
  echo "  matrix         - Scroll binary like The Matrix"
  echo "  doctor         - Run environment diagnostics"
  echo "  banner         - Print Bahoot ASCII logo"
  echo "  update         - Refresh CLI from GitHub"
  echo "  self-destruct  - Delete Bahoot CLI dramatically"
  echo "  troll          - Print fake errors"
  echo "  party          - Celebrate with confetti"
  echo "  scan           - Fake virus scan"
  echo "  boot           - Simulate OS boot"
  echo "  hack           - Fake hacking animation"
  echo "  glitch         - Terminal distortion effect"
  echo "  ball           - Bounce a ball around"
  echo "  fortune        - Get a random quote"
  echo "  echo [text]    - Repeat your input"
  echo "  clear          - Clear the screen"
  echo "  credits        - Show CLI credits"
  echo "  help           - Show this menu"
}
case "$1" in
  prank) prank ;;
  deploy) rocket ;;
  chaos) chaos ;;
  matrix) matrix ;;
  doctor) doctor ;;
  banner) banner ;;
  update) update ;;
  self-destruct) self_destruct ;;
  troll) troll ;;
  party) party ;;
  scan) scan ;;
  boot) boot ;;
  hack) hack ;;
  glitch) glitch ;;
  ball) ball ;;
  fortune) fortune ;;
  echo) shift; echo_cmd "$@" ;;
  clear) clear_cmd ;;
  credits) credits ;;
  help|"") help_menu ;;   # no banner here
  *) help_menu ;;
esac